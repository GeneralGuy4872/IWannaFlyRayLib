use strict;
use warnings;
use feature "switch";

open(my $file,'+>','./modules/IWannaFly/Constants.pm');

printf $file <<'ETX';
package IWannaFly::Constants;
require Exporter;
our @ISA = qw(Exporter);
our @EXPORT;
ETX
say $file '#AUTOGENERATED';

open(my $header,'<','./constants.h');

until (eof($header)) {
	if (<$header> =~ m/^#define ([\w]*) ([\S]*)(?:$|\t)/) {
		my $foo = $1;
		my $bar = $2;
		unless ($foo =~ m/CEILING/) {
			printf $file 'use constant C__';
			printf $file "$foo => $bar;\n";
			say $file 'push(@EXPORT,C__' . $foo . ');';
			}
		}
	}
close $header;
close $file;
__END__
